class e{constructor({position:e,velocity:t,text:i}){this.position=e,this.velocity=t,this.text=i,this.radius={x:r.measureText(this.text).width+10,y:r.measureText(this.text).width/1.5>20?r.measureText(this.text).width/1.5:20},this.letterIndex=0,this.style={fillStyle:"#294d61",shadowColor:"white",shadowOffsetY:2,shadowBlur:8,strokeStyle:"#6da5c0",lineWidth:2,font:"bold 18px Arial",hitText:"#EC9704",normalText:"#6da5c0",normalShadowColor:"white",normalStrokeStyle:"#6da5c0",hitShadowColor:"#EC9704",hitStrokeStyle:"#fbe4d8",destroyedShadowColor:"red",destroyedStrokeStyle:"#b51a2b"}}draw(){r.save(),r.beginPath(),r.fillStyle=this.style.fillStyle,r.ellipse(this.position.x,this.position.y,this.radius.x,this.radius.y,0,2*Math.PI,360),r.fill(),r.shadowColor=this.style.shadowColor,r.shadowOffsetY=this.style.shadowOffsetY,r.shadowBlur=this.style.shadowBlur,r.strokeStyle=this.style.strokeStyle,r.lineWidth=this.style.lineWidth,r.stroke(),r.closePath(),r.restore(),r.save(),r.font=this.style.font;let e=this.position.x-this.radius.x+10;for(let t=0;t<this.text.length;t++){const i=this.text[t];t<this.letterIndex?r.fillStyle=this.style.hitText:r.fillStyle=this.style.normalText,r.fillText(i,e,this.position.y+5),e+=r.measureText(i).width}r.restore()}update(){this.draw(),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}increaseLetterIndex(){this.letterIndex++}changeColor(){this.letterIndex===this.text.length?(this.style.fillStyle="gray",this.style.shadowColor=this.style.destroyedShadowColor,this.style.strokeStyle=this.style.destroyedStrokeStyle):(this.style.shadowColor=this.style.hitShadowColor,this.style.strokeStyle=this.style.hitStrokeStyle),setTimeout((()=>{this.style.shadowColor=this.style.normalShadowColor,this.style.strokeStyle=this.style.normalStrokeStyle}),300)}}class t{constructor(){this.positionY=0,this.velocityY=2*l.height}draw(){r.beginPath(),r.fillStyle="#05161a",r.fillRect(0,this.positionY,l.width,l.height),r.closePath()}update(){this.draw(),this.positionY<l.height&&(this.positionY+=this.velocityY)}}class i{constructor({scores:e,freezeTime:t,freezeCheckpointStep:i}){this.__scores=e,this.__freezeTime=t,this.__freezeCheckpointStep=i,this.__freezeCheckpoint=i,this.__isFreezed=!1,this.__isFreezeReady=!1,this.__notReadyAlert=!1}#e(){r.save(),r.beginPath(),r.strokeStyle="blue",r.lineWidth=3,r.shadowColor="blue",r.shadowBlur=5,r.strokeRect(0,0,l.width,l.height),r.stroke(),r.closePath(),r.restore()}update(e){return this.#t(),this.#i(),this.#s(),this.__scores=e,!!this.__isFreezeReady}#s(){this.__scores>=this.__freezeCheckpoint&&(this.__isFreezeReady=!0,this.__freezeCheckpoint+=this.__freezeCheckpointStep)}getIsFreezeReady(){return this.__isFreezeReady}setFreezed(){this.__isFreezed=!0,this.__isFreezeReady=!1,this.#t()}#t(){this.__isFreezed&&(this.#e(),setTimeout((()=>{this.__isFreezed=!1}),this.__freezeTime))}disableFreeze(){this.__isFreezeReady=!1}#o(){r.save(),r.beginPath(),r.strokeStyle="gray",r.lineWidth=3,r.shadowColor="gray",r.shadowBlur=5,r.strokeRect(0,0,l.width,l.height),r.stroke(),r.closePath(),r.restore()}#i(){this.__notReadyAlert&&(this.#o(),setTimeout((()=>{this.__notReadyAlert=!1}),300))}notifyNotReady(){this.__notReadyAlert=!0}}class s{constructor({scores:e,lives:t,dictionaryName:i}){this.style={fillStyle:"red",shadowColor:"red"},this.__isBubbleMissed=!1,this.__scores=e,this.__lives=t,this.__dictionaryName=i,this.__highScore=localStorage.getItem(`${this.__dictionaryName}_high_score`)||0,this.__wasNotified=!1,this.__lettersMatched=0,this.__lettersUnmatched=0}#e(){r.save(),r.beginPath(),r.strokeStyle=this.style.fillStyle,r.lineWidth=3,r.shadowColor=this.style.shadowColor,r.shadowBlur=5,r.strokeRect(0,0,l.width,l.height),r.stroke(),r.closePath(),r.restore()}update(){this.#t()}#t(){this.__isBubbleMissed&&(this.#e(),setTimeout((()=>{this.__isBubbleMissed=!1}),500))}bubbleMissed(){this.__isBubbleMissed=!0,this.#t()}setScores(e){this.__scores+=e}getScores(){return this.__scores}setLives(e){this.__lives+=e}getLives(){if(-1===this.__lives)return!1;let e=" ";for(let t=0;t<this.__lives;t++)e+='<svg\n          xmlns="http://www.w3.org/2000/svg"\n          fill="none"\n          viewBox="0 0 24 24"\n          stroke-width="1.5"\n          stroke="#EC9704"\n          class="info-fire-icon"\n        >\n          <path\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z"\n          />\n          <path\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            d="M12 18a3.75 3.75 0 00.495-7.467 5.99 5.99 0 00-1.925 3.546 5.974 5.974 0 01-2.133-1A3.75 3.75 0 0012 18z"\n          />\n        </svg>';return e}getHighScore(){return this.__scores>this.__highScore?(this.#n(this.__scores),`${this.__highScore} <span class="new-record-badge">New record!</span>`):this.__highScore}#n(e){localStorage.setItem(`${this.__dictionaryName}_high_score`,e),this.__highScore=e}freezeNotification(e){this.__wasNotified||(e.style.display="block",this.__wasNotified=!0)}cleanFreezeNotification(e){e.style.display="none"}letterMatch(){this.__lettersMatched++}letterUnmatch(){this.__lettersUnmatched++}getAccuracy(){const e=this.__lettersMatched/(this.__lettersMatched+this.__lettersUnmatched)*100||0;return`${Math.round(e)}%`}}class o{constructor({position:e,radius:t}){this.position=e,this.radius=t,this.style={fillStyle:"rgba(6, 88, 47, 0.02)",shadowColor:"rgba(6, 88, 47, 1)",strokeStyle:"#6da5c0",shootShadowColor:"#EC9704",shootStrokeStyle:"#EC9704"}}draw(){r.save(),r.beginPath(),r.arc(this.position.x,this.position.y+this.radius/2,this.radius,0,2*Math.PI,!1),r.fillStyle=this.style.fillStyle,r.fill(),r.shadowColor=this.style.shadowColor,r.shadowOffset=2,r.shadowBlur=16,r.strokeStyle=this.style.strokeStyle,r.lineWidth=5,r.stroke(),r.closePath(),r.restore()}shootEffect(){r.save(),r.beginPath(),r.arc(this.position.x,this.position.y+this.radius/2,1.25*this.radius,0,2*Math.PI,!1),r.fillStyle=this.style.fillStyle,r.fill(),r.shadowColor=this.style.shootShadowColor,r.shadowOffset=2,r.shadowBlur=16,r.strokeStyle=this.style.shootStrokeStyle,r.lineWidth=5,r.stroke(),r.closePath(),r.restore()}}class n{constructor({position:e,velocity:t,rotation:i}){this.position=e,this.velocity=t,this.rotation=i,this.width=5,this.style={fillStyle:"#6da5c0"}}draw(){r.save(),r.translate(this.position.x,this.position.y),r.rotate(this.rotation),r.translate(-this.position.x,-this.position.y),r.beginPath(),r.fillStyle=this.style.fillStyle,r.fillRect(this.position.x,this.position.y,this.width,l.height),r.closePath(),r.restore()}update(){this.position.y<l.height/2&&(this.width=2),this.draw(),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}}const l=document.querySelector("canvas"),r=l.getContext("2d"),a=document.getElementById("background"),h=document.getElementById("infoTable"),d=document.getElementById("infoScores"),c=document.getElementById("lives"),y=document.getElementById("canvasMenuLinkBtn"),u=document.getElementById("playBtn"),g=document.getElementById("aboutBtn"),p=document.getElementById("mainMenuTable"),_=document.getElementById("dictionarySelect"),m=document.getElementById("aboutBadge"),w=document.getElementById("closeAboutBtn"),f=document.getElementById("gameOverTable"),S=document.getElementById("gameOverScore"),v=document.getElementById("gameOverHighest"),k=document.getElementById("gameOverAccuracy"),x=document.getElementById("playAgainBtn"),b=document.getElementById("gameOverMenuLinkBtn"),I=document.getElementById("snowflakeImg"),C=document.getElementById("snowflakeIcon"),B=document.getElementById("freezeNotification");l.width=window.innerWidth,l.height=window.innerHeight;const L=new class{constructor(e){this.__dictionaries=e,this.__chosenDictionary=localStorage.getItem("dictionary")||"CS50"}renderDictionariesList(){let e="";for(let t in this.__dictionaries)e+=`<option value="${t}">${t}</option>`;return e}setChosenDictionary(e){for(let t in this.__dictionaries)if(t===e)return this.__chosenDictionary=e,localStorage.setItem("dictionary",e),!0;return console.log("Dictionary wasn't set: ",e),!1}getDictionary(){return this.__dictionaries[this.__chosenDictionary]}getDictionaryName(){return this.__chosenDictionary}}({CS50:["cs50","array","code","C","python","HTTP","TCP","IP","flask","memory","scratch","fiftyville","mario","django","AI","queue","stack","heap","sort","bubble","merge","git","bootstrap","HTML","CSS","javascript","science","pointer","halloween","dracula","duck","debug","finance","tideman","SQL","ninja","emoji","data","struct","page","loop","if","else","elif","type","form","tag"],Lorem:["Lorem","Ipsum","is","simply","dummy","text","of","the","and","industry","book","ever","since","desktop","like","fact","long","gallery","page","leap","point","site","year","root","day","line","chunk","section","form","tag","amet","sed","et","do","ut","enim"],"Guardians of Galaxy":["Star","Lord","Gamora","Drax","Rocket","Groot","Awesome","Mix","Milano","Infinity","Love","Stone","Quill","Yondu","Nebula","Ronan","Ego","Ravager","Orb","Nova","Dance","Guardians","Tower","Sovereign","Collector","Knowhere","Kree","Blaster","Mask","Vengeance","Sword","Xandar","Gadget","Ego","Planet","Arrow","Soul","Cosmo","Ship","Warlock","Retro","Dance","Whistle"]});function E(){l.style.display="none",f.style.display="none",h.style.display="none",y.style.display="none",B.style.display="none",a.style.display="block",p.style.display="flex",_.innerHTML=L.renderDictionariesList(),_.value=L.getDictionaryName()}function M(){l.style.display="block",a.style.display="none",p.style.display="none",f.style.display="none",C.style.display="none",I.style.display="none",h.style.display="block",y.style.display="block";const u=new s({scores:0,lives:3,dictionaryName:L.getDictionaryName()}),g=new i({scores:u.getScores(),freezeTime:4e3,freezeCheckpointStep:100}),_=new o({position:{x:l.width/2,y:l.height},radius:125}),m=new t,w=L.getDictionary();d.innerHTML=u.getScores(),c.innerHTML=u.getLives();const S=[],v=[];let k,x,b,M=1e3;function z(){const t=Math.random()*l.width,i=Math.floor(Math.random()*w.length),s=[];for(let e=S.length-1;e>=0;e--){const t=S[e];s.includes(t.text)||s.push(t.text)}!s.includes(w[i])&&t>50&&t<l.width-70&&S.push(new e({position:{x:t,y:-50},velocity:{x:0,y:w[i].length/-15+1.3},text:w[i]}))}function R(e){let t=!1;for(let s=S.length-1;s>=0;s--){const o=S[s];o.text[o.letterIndex].toLowerCase()===e.toLowerCase()&&(i=o,v.push(new n({position:{x:_.position.x,y:_.position.y},velocity:{x:700*K({x:_.position.x,y:_.position.y},i),y:700*N({x:_.position.x,y:_.position.y},i)},rotation:K({x:_.position.x,y:_.position.y},i)})),o.increaseLetterIndex(),o.changeColor(),t=!0)}var i;t?u.letterMatch():u.letterUnmatch()}function K(e,t){const i=t.position.x-e.x,s=t.position.y-e.y;return i/Math.sqrt(i*i+s*s)}function N(e,t){const i=t.position.x-e.x,s=t.position.y-e.y;return s/Math.sqrt(i*i+s*s)}k=window.setInterval(z,M),b=window.setInterval((()=>{M-=50,200===M&&window.clearInterval(b)}),1e4),function e(){x=window.requestAnimationFrame(e),r.fillStyle="rgba(5, 22, 26, 0.2)",r.fillRect(0,0,l.width,l.height),_.draw(),u.update(),g.update(u.getScores())&&(C.style.display="block",u.freezeNotification(B));for(let e=v.length-1;e>=0;e--){const t=v[e];t.update(),_.draw(),_.shootEffect(),t.position.y<0&&v.splice(e,1)}for(let e=S.length-1;e>=0;e--){const t=S[e];t.update(),m.update(),t.position.y>l.height-30&&(u.bubbleMissed(),S.splice(e,1),u.setLives(-1),u.getLives()?c.innerHTML=u.getLives():T(x,k,b,u,g)),t.letterIndex===t.text.length&&(S.splice(e,1),u.setScores(t.text.length),d.innerHTML=u.getScores())}}();const P=["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM"];window.addEventListener("keydown",(e=>{switch(P.includes(e.code)&&R(e.code[3]),e.code){case"Digit0":R("0");break;case"Digit5":R("5");break;case"Space":!function(){if(g.getIsFreezeReady()){C.style.display="none",I.style.display="block",g.setFreezed(),clearInterval(k);for(let e=S.length-1;e>=0;e--)S[e].velocity.y=0;setTimeout((()=>{for(let e=S.length-1;e>=0;e--){const t=S[e];t.velocity.y=t.text.length/-15+1.3,I.style.display="none"}k=window.setInterval(z,M)}),4e3),u.cleanFreezeNotification(B)}else g.notifyNotReady()}()}})),y.addEventListener("click",(function e(){return window.cancelAnimationFrame(x),clearInterval(k),clearInterval(b),E(),y.removeEventListener("click",e)}))}function T(e,t,i,s,o){window.cancelAnimationFrame(e),clearInterval(t),clearInterval(i),o.disableFreeze(),f.style.display="flex",S.innerHTML=s.getScores(),v.innerHTML=s.getHighScore(),k.innerHTML=s.getAccuracy(),h.style.display="none",y.style.display="none",B.style.display="none"}function z(e,t,i){e.classList.add("animation-fade"),setTimeout((()=>{e.classList.remove("animation-fade"),e.style.display="none",t.style.display="flex",t.classList.add("animation-appear"),setTimeout((()=>{t.classList.remove("animation-appear")}),i)}),i)}_.addEventListener("change",(e=>{L.setChosenDictionary(e.target.value)||console.log("Set wrong dictionary")})),E(),u.addEventListener("click",M),x.addEventListener("click",M),b.addEventListener("click",E),g.addEventListener("click",(()=>z(p,m,300))),w.addEventListener("click",(()=>z(m,p,300)));